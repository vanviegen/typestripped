import{typestripped as t}from"./typestripped.js";let e={};function r(o){if(o.slice(-3)===".js")return o;const n=new URL(o,location.href).toString();let s=e[n];if(!s){const c=new XMLHttpRequest;c.open("GET",n,false);c.send(null);if(c.status!==200){throw new Error(`HTTP error! status: ${c.status} for ${n}`)}const a=c.responseText;const i=t(a,{recover:true,transformImport:r})+"\n//# sourceURL="+o;const l=new Blob([i],{type:"application/javascript"});s=URL.createObjectURL(l);e[n]=s}console.log(`typestripped browser transformed import`,n,s);return s}export async function transpile(e){let o;const n=e.getAttribute("src");if(n){const t=await fetch(n);if(!t.ok){throw new Error(`Failed to fetch ${n}: ${t.status} ${t.statusText}`)}o=await t.text()}else{o=e.textContent||""}const s=document.createElement("script");let c=t(o,{recover:true,transformImport:r});if(n)c+="\n//# sourceURL="+n;s.textContent=c;s.setAttribute("type","module");e.parentNode.replaceChild(s,e)}export async function transpileAll(){const t=document.querySelectorAll('script[type="text/typescript"]');for(const e of t){try{await transpile(e)}catch(t){console.error(t)}}}document.addEventListener("DOMContentLoaded",transpileAll);