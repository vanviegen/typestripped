export class ParseError extends Error{}function e(e,r){e.toString=()=>"<"+r+">";return e}const r=e(/(\s|\/\/.*|\/\*[\s\S]*?\*\/)+/y,"whitespace"),t=e(/[a-zA-Z_$][0-9a-zA-Z_$]*/y,"identifier"),f=e(/(['"])(?:(?=(\\?))\2.)*?\1/y,"string"),n=e(/[+-]?\d+(\.\d+)?([eE][+-]?\d+)?/y,"number"),i=e(/instanceof\b|in\b|[!=]==|\|\|=?|&&=?|[+\-*\/%&|^!=<>]=|[+\-*\/%&|^=<>]/y,"bin-op"),u=e(/[\s\S]*?(\${|`)/y,"`string`"),l=e(/\+\+|--|!|~|\+|-|typeof\b|delete\b|await\b/y,"pre-op"),s=e(/\/(\\.|[^\/])+\/[gimsuyd]*/y,"regexp"),a=/[\s\S]/y,o=/\S/g,c=/^[a-zA-Z0-9]+$/;export function typestripped(e,h=false,b=false){let y=0;let d=1;let k=1;let $="";let g=0;let m=0;let E=0;let v=new Set;let x=true;let A=0;S();return $;function S(){pe(r);while(ue(Z)){}if(y<e.length)ie(false)}function Z(){A=$.length;if(O()||C()||G()||P()||I()||te()||_()||J()||N()||T()||j()||B()||D()||F()||q()||z()||pe(";"))return true;return false}function z(){if(!R())return false;ae();return true}function P(){if(!pe("export"))return false;if(pe("default")){ie(U()||te())}else{ie(O()||C()||te()||U()||X())}ae();return true}function O(){if(!pe("let")&&!pe("const")&&!pe("var"))return false;if(ce("enum")){console.info("Const enums are not supported");return I()}while(true){ie(pe(t));if(oe(":")){ie(oe(re))}if(pe("="))ie(U);if(!pe(","))break}ae();return true}function C(){if(!oe("type"))return false;se();ie(oe(t));oe(H);if(oe("="))ie(oe(re));ae();return true}function I(){let e=$.length;if(!pe("enum"))return false;let r=ie(pe(t));ie(pe("{"));ne(e,`var ${r} = (function (${r}) {`);let f=0,i=true;while(i){e=$.length;let u=pe(t);if(!u)break;if(pe("=")){f=parseInt(ie(pe(n)))}if(!pe(","))i=false;ne(e,`${r}[(${r}["${u}"] = ${f++})] = "${u}";`)}e=$.length;ie(pe("}"));ne(e,`return ${r};})(${r} || {});`);return true}function _(){if(!pe("return"))return false;U();ae();return true}function J(){const e=pe("if")||pe("while");if(!e)return false;ie(pe("("));ie(U);ie(pe(")"));ie(Z);if(e==="if"&&pe("else"))ie(Z);return true}function N(){if(!pe("throw"))return false;ie(U);ae();return true}function T(){if(!pe("do"))return false;ie(Z);ie(pe("while"));ie(pe("("));ie(U);ie(pe(")"));ae();return true}function j(){if(!pe("for"))return false;ie(pe("("));if(pe("let")||pe("const")||pe("var")){ie(pe(t));if(oe(":"))ie(oe(re));if(pe("="))ie(U)}else{R()}if(pe("of")||pe("in")){ie(R())}else{ie(pe(";"));R();ie(pe(";"));R()}ie(pe(")"));ie(Z);return true}function q(){if(!pe("switch"))return false;ie(pe("("));ie(U);ie(pe(")"));ie(pe("{"));let e=false;while(!pe("}")){if(pe("case")&&ie(U)||pe("default")){ie(pe(":"));e=true}else{ie(e&&ue(Z))}}}function B(){if(!pe("import"))return false;if(pe("*")){ie(pe("as"));ie(pe(t))}else{ie(pe("{"));while(true){if(!pe(t))break;if(pe("as"))ie(pe(t));if(!pe(","))break}ie(pe("}"))}ie(pe("from"));ie(pe(f));ae();return true}function D(){if(!pe("try"))return;ie(G);if(pe("catch")){if(pe("(")){ie(pe(t));if(oe(":"))ie(oe(re));ie(pe(")"))}ie(G)}if(pe("finally"))ie(G);return true}function F(){if(!oe("declare"))return false;oe("enum");ie(oe(t));ie(oe(G));return true}function G(){if(!pe("{"))return false;while(ue(Z)){}ie(pe("}"));return true}function H(){if(oe("<")){while(true){ie(oe(t));if(oe("extends"))ie(oe(re));if(!oe(","))break}ie(oe(">"));return true}return false}function K(e=false){let r="";if(!pe("("))return false;while(true){if(pe("..."))ie(pe(t));else if(e&&(oe("public")||oe("private")||oe("protected"))){const e=ie(pe(t));r+=`this.${e}=${e};`}else if(!pe(t))break;pe("?");if(oe(":"))ie(oe(re));if(pe("="))ie(U);if(!pe(","))break}ie(pe(")"));return e&&r?r:true}function L(){if(!pe("async","function")&&!pe("function"))return false;pe(t);H();ie(K);if(oe(":"))ie(oe(re));if(G())return true;ae();se();return true}function M(){if(!le((()=>{pe("async");H();if(!K()&&!pe(t))return false;if(oe(":"))ie(oe(re));if(!pe("=>"))return false;return true})))return false;ie(G()||U());return true}function Q(){if(!pe("("))return false;ie(R);ie(pe(")"));return true}function R(){if(!U())return false;while(pe(","))ie(U);return true}function U(e=false){let r=false;while(pe(l))r=true;if(pe("new")){e=true;r=true}if(pe(f)||V()||pe(n)||te()||L()||M()||Q()||pe(t)||W()||X()||pe(s)){}else{if(r)ie(false);return false}if(e&&oe("<")){ie(oe(re));while(oe(","))ie(oe(re));ie(oe(">"))}while(true){if(ce("("))Y();else if(ce("["))ee();else if(pe("++")||pe("--")){}else if(oe("as"))ie(oe(re));else if(pe("?."))ie(pe(t)||ee());else if(pe("."))ie(pe(t));else if(pe(i)){ie(U);return true}else if(oe("!")){}else break}if(pe("?")){ie(U);ie(pe(":"));ie(U)}return true}function V(){if(!pe("`"))return false;while(true){let e=ie(pe(u));if(e.slice(-1)==="`")break;ie(U);ie(pe("}"))}return true}function W(){if(!pe("["))return false;while(true){if(pe("..."))ie(U);else U();if(!pe(","))break}ie(pe("]"));return true}function X(){if(!pe("{"))return false;while(true){if(pe("..."))ie(U);else{if(pe("[")){ie(U);ie(pe("]"))}else{if(!pe(t)&&!pe(n))break}if(H()&&ie(K())||K()){if(oe(":")){oe(re)}ie(G())}else{if(pe(":"))ie(U)}if(!pe(","))break}}ie(pe("}"));return true}function Y(){if(!pe("("))return false;while(true){if(pe("..."))ie(U);else if(!U())break;if(!pe(","))break}ie(pe(")"));return true}function ee(){if(!pe("["))return false;ie(R);ie(pe("]"));return true}function re(e=true){let r=false;if(pe("typeof"))return ie(U);if(pe("keyof"))r=true;if(pe(t)){if(pe("<")){ie(re);while(pe(",")){ie(re)}ie(pe(">"))}}else if(pe("{")){while(true){if(pe("[")){ie(pe(t));ie(pe(":"));ie(re);ie(pe("]"))}else if(!pe(t))break;if(pe(":"))ie(re);if(!pe(","))break}ie(pe("}"))}else if(pe("[")){while(true){if(!re())break;if(!pe(","))break}ie(pe("]"))}else if(e&&le(K)){ie(pe("=>"));ie(re);return true}else if(pe("(")){ie(re);ie(pe(")"))}else if(!pe(n)&&!pe(f)){if(r)ie(false);return false}while(pe("[")){re();ie(pe("]"))}while(true){if(pe("|")||pe("&")){ie(re(false))}else{break}}if(pe("extends")){ie(re);ie(pe("?"));ie(re);ie(pe(":"));ie(re)}return true}function te(){let e=false;if(oe("abstract")){ie(pe("class"))}else{if(oe("interface")){e=true;se();g++}else if(!pe("class")){return false}}pe(t);H();if(pe("extends")){ie(U(true))}while(oe("implements"))ie(oe(re));ie(pe("{"));while(!pe("}")){ie(pe(";")||ue((()=>fe(e))))}if(e)g--;return true}function fe(e=false){A=$.length;e||(e=!!oe("abstract"));oe("public")||oe("private")||oe("protected");e||(e=!!oe("abstract"));pe("get")||pe("set");if(pe("static")){if(G())return true}pe("async");const r=pe(t);if(!r){if($.length!==A){ie(false)}return false}if(!ce("<")&&!ce("(")){if(oe(":"))ie(oe(re));if(pe("="))ie(U);ae();return true}oe(H);let f=ie(K(r==="constructor"));if(oe(":"))ie(oe(re));if(e||!pe("{")){ae();se();return true}if(typeof f!=="string"){while(!pe("}"))ie(ue(Z));return true}if(le((()=>{ne($.length,f);while(!pe("}")){if(ce("super","("))return false;ie(ue(Z))}return true})))return true;while(!pe("}")){let e=ce("super","(");ie(ue(Z));if(e)ne($.length,f)}return true}function ne(e,r){let t=$.substring(e);let f=t.split("\n");let n=f.length-1;let i=r.split("\n").length-1;if(i>n)throw new Error("Invalid replaceOutput");$=$.substring(0,e)+r;$+="\n".repeat(n-i);let u=f[f.length-1];if(u.trim()==="")$+=u;if(h)we("replace output",p(t),"by",p($.substr(e)))}function ie(r){if(typeof r==="function")r=r();if(r)return r;let t=(new Error).stack||"";let f=/\bat parse([A-Z][a-zA-Z]*)/.exec(t)||["","top-level"];let n=[];let i=[];for(let e of v){if(e instanceof ParseError)i.push(e.message);else if(e instanceof Array)n.push(w(e," + "));else n.push(e)}let u=new ParseError(`Could not parse ${f[1]} at ${d}:${k}, got ${p(e.substr(y,8))}[..], expected one of:   ${w(n,"   ")}`);if(i.length)u.t=i;throw u}function ue(n){if(E||!b)return n();let i=y;try{return n()}catch(n){if(!(n instanceof ParseError))throw n;console.error(n);console.info("Trying to recover...");while(y<e.length&&!pe(";")&&!pe("}")){ie(pe(r)||pe(t)||pe(f)||pe(a));if(x)break}return y>i}}function le(e){let r={i:y,line:d,u:k,l:$,o:v};v=new Set;E++;try{let t=e();if(t)return t;if(y===r.i&&$===r.l)return false;ie(false)}catch(e){if(!(e instanceof ParseError))throw e;r.o.add(e)}finally{E--}y=r.i;d=r.line;k=r.u;$=r.l;if(h)we("reverted attempt");v=r.o;return false}function se(){const e=$.substr(A);const r=e.replace(o," ");if(e!==r){if(h)we("wipe output",p(e));$=$.substr(0,A)+r}}function ae(){if(y>=e.length)return true;if(pe(";"))return true;if(x)return true;if(ce("}"))return true;ie(false);return false}function oe(...e){g++;const r=e.length===1&&typeof e[0]==="function"?e[0]():pe(...e);g--;return r}function ce(...e){m++;const r=pe(...e);m--;return r}function pe(...t){let f=y;let n;let i=false;for(let u of t){n=undefined;if(typeof u==="string"){if(e.substr(y,u.length)===u&&(!u.slice(-1).match(c)||!e.substr(y+u.length,1).match(c)))n=u}else{u.lastIndex=y;const r=u.exec(e);if(r)n=r[0]}if(n===undefined){y=f;v.add(t.length==1?t[0]:t);return}y+=n.length;r.lastIndex=y;let l=(r.exec(e)||[""])[0];y+=l.length;i=l.indexOf("\n")>=0}if(m){y=f;return n}const u=e.substring(f,y);v.clear();x=i;if(h)we(g?"skip":"eat",p(u),"as",w(t," + "));const l=u.lastIndexOf("\n");if(l>=0){d+=u.split("\n").length-1;k=u.length-l}else{k+=u.length}if(g)$+=u.replace(o," ");else $+=u;return n}function we(...e){let r=Array(...((new Error).stack||"").matchAll(/\bat parse([A-Z][a-zA-Z]+).*?(:\d+)/g)||[]).map((e=>e[1]+e[2]));(typeof h==="function"?h:console.debug)(d+":"+k,...e,"parsing",r.join(" <- "))}}function p(e){return JSON.stringify(e)}function w(e,r){return e.map((e=>typeof e==="string"?p(e):e.toString())).toSorted().join(r)}