export class ParseError extends Error{}function e(e,t){e.toString=()=>"<"+t+">";return e}const t=e(/(\s|\/\/.*|\/\*[\s\S]*?\*\/)+/y,"whitespace"),r=e(/[a-zA-Z_$][0-9a-zA-Z_$]*/y,"identifier"),n=e(/(['"])(?:(?=(\\?))\2.)*?\1/y,"string"),i=e(/[+-]?(?:0[xX][0-9a-fA-F]+|0[oO][0-7]+|0[bB][01]+|\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)/y,"number"),f=e(/instanceof\b|in\b|[!=]==|\|\|=?|>>=?|<<=?|&&=?|[+\-*\/%&|^!=<>]=|[+\-*\/%&|^=<>]/y,"bin-op"),u=e(/[\s\S]*?(\${|`)/y,"`string`"),l=e(/\+\+|--|!|~|\+|-|typeof\b|delete\b|await\b/y,"unary-op"),s=e(/\/(\\.|[^\/])+\/[gimsuyd]*/y,"regexp"),a=/[\s\S]/y,o=/\S/g,c=/^[a-zA-Z0-9]+$/;export function typestripped(e,{debug:g,recover:b,transformImport:w}={}){let d=0;let y=1;let m=1;let k="";let $=0;let x=0;let A=0;let v=new Set;let E=true;let S=0;O();return k;function O(){ge(t);while(se(Z,true)){}if(d<e.length)le(false)}function Z(){S=k.length;if(P()||j()||H()||z()||C()||ie()||_()||B()||F()||J()||N()||q()||D()||G()||X()||I()||ge(";"))return true;return false}function I(){if(!T())return false;ce();return true}function z(){if(!ge("export"))return false;if(ge("default")){le(U()||ie())}else{le(P()||j()||ie()||U()||Y())}ce();return true}function P(){if(!ge("let")&&!ge("const")&&!ge("var"))return false;if(pe("enum")){console.error("Const enums are not supported");return C()}while(true){le(ge(r));if(he(":")){le(he(ne))}if(ge("="))le(U);if(!ge(","))break}ce();return true}function j(){if(!he("type"))return false;oe();le(he(r));he(K);if(he("="))le(he(ne));ce();return true}function C(){let e=k.length;if(!ge("enum"))return false;let t=le(ge(r));le(ge("{"));ue(e,`var ${t} = (function (${t}) {`);let n=0,f=true;while(f){e=k.length;let u=ge(r);if(!u)break;if(ge("=")){n=parseInt(le(ge(i)))}if(!ge(","))f=false;ue(e,`${t}[(${t}["${u}"] = ${n++})] = "${u}";`)}e=k.length;le(ge("}"));ue(e,`return ${t};})(${t} || {});`);return true}function _(){if(!ge("return")&&!ge("yield"))return false;U();ce();return true}function B(){const e=ge("if")||ge("while");if(!e)return false;le(ge("("));le(U);le(ge(")"));le(Z);if(e==="if"&&ge("else"))le(Z);return true}function F(){if(!ge("throw"))return false;le(U);ce();return true}function J(){if(!ge("do"))return false;le(Z);le(ge("while"));le(ge("("));le(U);le(ge(")"));ce();return true}function N(){if(!ge("for"))return false;le(ge("("));if(ge("let")||ge("const")||ge("var")){le(ge(r));if(he(":"))le(he(ne));if(ge("="))le(U)}else{T()}if(ge("of")||ge("in")){le(T())}else{le(ge(";"));T();le(ge(";"));T()}le(ge(")"));le(Z);return true}function X(){if(!ge("switch"))return false;le(ge("("));le(U);le(ge(")"));le(ge("{"));let e=false;while(!ge("}")){if(ge("case")&&le(U)||ge("default")){le(ge(":"));e=true}else{le(e&&se(Z))}}}function q(){if(!ge("import"))return false;if(ge("*")){le(ge("as"));le(ge(r))}else{le(ge("{"));while(true){if(!ge(r))break;if(ge("as"))le(ge(r));if(!ge(","))break}le(ge("}"))}le(ge("from"));let e=k.length;le(ge(n));if(w){let t=k.substring(e+1,k.length-1);t=w(t);ue(e,'"'+t+'"')}ce();return true}function D(){if(!ge("try"))return;le(H);if(ge("catch")){if(ge("(")){le(ge(r));if(he(":"))le(he(ne));le(ge(")"))}le(H)}if(ge("finally"))le(H);return true}function G(){if(!he("declare"))return false;he("enum");le(he(r));le(he(H));return true}function H(){if(!ge("{"))return false;while(!ge("}"))se(Z,true);return true}function K(){if(he("<")){while(true){le(he(r));if(he("extends"))le(he(ne));if(!he(","))break}le(he(">"));return true}return false}function L(e=false){let t="";if(!ge("("))return false;while(true){if(ge("..."))le(ge(r));else if(e&&(he("public")||he("private")||he("protected"))){const e=le(ge(r));t+=`this.${e}=${e};`}else if(!ge(r))break;he("?");if(he(":"))le(he(ne));if(ge("="))le(U);if(!ge(","))break}le(ge(")"));return e&&t?t:true}function M(){if(!ge("async","function")&&!ge("function"))return false;ge(r);K();le(L);if(he(":"))le(he(ne));if(H())return true;ce();oe();return true}function Q(){if(!ae((()=>{ge("async");K();if(!L()&&!ge(r))return false;if(he(":"))le(he(ne));if(!ge("=>"))return false;return true})))return false;le(H()||U());return true}function R(){if(!ge("("))return false;le(T);le(ge(")"));return true}function T(){if(!U())return false;while(ge(","))le(U);return true}function U(){let e=false;while(ge(l))e=true;if(ge("new"))e=true;if(ge(n)||V()||ge(i)||ie()||M()||Q()||R()||ge(r)||W()||Y()||ge(s)){}else{if(e)le(false);return false}while(true){if(pe("("))te();else if(pe("["))re();else if(ge("++")||ge("--")){}else if(he("as"))le(he(ne));else if(ge("?."))le(ge(r)||re());else if(ge("."))le(ge(r));else if(pe("<")&&ee()){}else if(ge(f)){le(U);return true}else if(he("!")){}else break}if(ge("?")){le(U);le(ge(":"));le(U)}return true}function V(){if(!ge("`"))return false;while(true){let e=le(ge(u));if(e.slice(-1)==="`")break;le(U);le(ge("}"))}return true}function W(){if(!ge("["))return false;while(true){if(ge("..."))le(U);else U();if(!ge(","))break}le(ge("]"));return true}function Y(){if(!ge("{"))return false;while(true){if(ge("..."))le(U);else{ge("*");if(ge("[")){le(U);le(ge("]"))}else{if(!ge(r)&&!ge(i)&&!ge(n)&&!V)break}if(K()&&le(L())||L()){if(he(":")){he(ne)}le(H())}else{if(ge(":"))le(U)}if(!ge(","))break}}le(ge("}"));return true}function ee(){return ae((()=>{if(!he("<"))return false;le(he(ne));while(he(","))le(he(ne));le(he(">"));if(pe(".")||pe("(")||pe("{")||pe(";")||d>=e.length)return true;return false}))}function te(){if(!ge("("))return false;while(true){if(ge("..."))le(U);else if(!U())break;if(!ge(","))break}le(ge(")"));return true}function re(){if(!ge("["))return false;le(T);le(ge("]"));return true}function ne(e=true){let t=false;if(ge("typeof"))return le(U);if(ge("keyof"))t=true;if(ge(r)){if(ge("<")){le(ne);while(ge(",")){le(ne)}le(ge(">"))}}else if(ge("{")){while(true){if(ge("[")){le(ge(r));le(ge(":"));le(ne);le(ge("]"))}else if(!ge(r)&&!ge(i)&&!ge(n))break;le(ge(":"));le(ne);if(!ge(","))break}le(ge("}"))}else if(ge("[")){while(true){if(!ne())break;if(!ge(","))break}le(ge("]"))}else if(e&&ae(L)){le(ge("=>"));le(ne);return true}else if(ge("(")){le(ne);le(ge(")"))}else if(!ge(i)&&!ge(n)){if(t)le(false);return false}while(ge("[")){ne();le(ge("]"))}while(true){if(ge("|")||ge("&")){le(ne(false))}else{break}}if(ge("extends")){le(ne);le(ge("?"));le(ne);le(ge(":"));le(ne)}return true}function ie(){let e=false;if(he("abstract")){le(ge("class"))}else{if(he("interface")){e=true;oe();$++}else if(!ge("class")){return false}}ge(r);K();if(ge("extends"))le(U());while(he("implements"))le(he(ne));le(ge("{"));while(!ge("}")){le(ge(";")||se((()=>fe(e)),true))}if(e)$--;return true}function fe(e=false){S=k.length;e||(e=!!he("abstract"));he("public")||he("private")||he("protected");e||(e=!!he("abstract"));pe("get",r)&&ge("get")||pe("set",r)&&ge("set");if(ge("static")){if(H())return true}ge("async");ge("*");const t=ge(r);if(!t){if(ge("[")){le(U);le(ge("]"))}else{if(k.length!==S){le(false)}return false}}if(!pe("<")&&!pe("(")){if(he(":"))le(he(ne));if(ge("="))le(U);ce();return true}he(K);let n=le(L(t==="constructor"));if(he(":"))le(he(ne));if(e||!ge("{")){ce();oe();return true}if(typeof n!=="string"){while(!ge("}"))le(se(Z));return true}if(ae((()=>{ue(k.length,n);while(!ge("}")){if(pe("super","("))return false;le(se(Z))}return true})))return true;while(!ge("}")){let e=pe("super","(");le(se(Z));if(e)ue(k.length,n)}return true}function ue(e,t){let r=k.substring(e);let n=r.split("\n");let i=n.length-1;let f=t.split("\n").length-1;if(f>i)throw new Error("Invalid replaceOutput");k=k.substring(0,e)+t;k+="\n".repeat(i-f);let u=n[n.length-1];if(u.trim()==="")k+=u;if(g)we("replace output",h(r),"by",h(k.substr(e)))}function le(t){if(typeof t==="function")t=t();if(t)return t;let r=(new Error).stack||"";let n=/\bat parse([A-Z][a-zA-Z]*)/.exec(r)||["","top-level"];let i=[];let f=[];for(let e of v){if(e instanceof ParseError)f.push(e.message);else if(e instanceof Array)i.push(p(e," + "));else i.push(e)}let u=new ParseError(`Could not parse ${n[1]} at ${y}:${m}, got ${h(e.substr(d,24))}, expected one of:   ${p(i,"   ")}`);if(f.length)u.attempts=f;throw u}function se(i,f=false){if(A||!b)return i();let u=d;try{const e=i();if(f&&u===d)le(false);return e}catch(i){if(!(i instanceof ParseError))throw i;console.error(i);console.error("Attempting to recover...");while(d<e.length&&!ge(";")&&!ge("}")){le(ge(t)||ge(r)||ge(n)||ge(a));if(E)break}return d>u}}function ae(e){let t={pos:d,line:y,col:m,out:k,matchOptions:v};v=new Set;A++;try{let r=e();if(r)return r;if(d===t.pos&&k===t.out)return false;le(false)}catch(e){if(!(e instanceof ParseError))throw e;t.matchOptions.add(e)}finally{A--}d=t.pos;y=t.line;m=t.col;k=t.out;if(g)we("reverted attempt");v=t.matchOptions;return false}function oe(){const e=k.substr(S);const t=e.replace(o," ");if(e!==t){if(g)we("wipe output",h(e));k=k.substr(0,S)+t}}function ce(){if(d>=e.length)return true;if(ge(";"))return true;if(E)return true;if(pe("}"))return true;le(false);return false}function he(...e){$++;const t=e.length===1&&typeof e[0]==="function"?e[0]():ge(...e);$--;return t}function pe(...e){x++;const t=ge(...e);x--;return t}function ge(...r){let n=d;let i;let f=false;for(let u of r){i=undefined;if(typeof u==="string"){if(e.substr(d,u.length)===u&&(!u.slice(-1).match(c)||!e.substr(d+u.length,1).match(c)))i=u}else{u.lastIndex=d;const t=u.exec(e);if(t)i=t[0]}if(i===undefined){d=n;v.add(r.length==1?r[0]:r);return}d+=i.length;t.lastIndex=d;let l=(t.exec(e)||[""])[0];d+=l.length;f=l.indexOf("\n")>=0}if(x){d=n;return i}const u=e.substring(n,d);v.clear();E=f;if(g)we($?"skip":"eat",h(u),"as",p(r," + "));const l=u.lastIndexOf("\n");if(l>=0){y+=u.split("\n").length-1;m=u.length-l}else{m+=u.length}if($)k+=u.replace(o," ");else k+=u;return i}function be(){let e=Array(...((new Error).stack||"").matchAll(/\bat parse([A-Z][a-zA-Z]+).*?(:\d+)/g)||[]).map((e=>e[1]+e[2]));return e.join(" <- ")}function we(...e){(typeof g==="function"?g:console.debug)(y+":"+m,...e,"parsing",be())}}function h(e){return JSON.stringify(e)}function p(e,t){return e.map((e=>typeof e==="string"?h(e):e.toString())).toSorted().join(t)}