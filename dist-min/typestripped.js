export class ParseError extends Error{}function e(e,t){e.toString=()=>"<"+t+">";return e}const t=e(/(\s|\/\/.*|\/\*[\s\S]*?\*\/)+/y,"whitespace"),r=e(/[a-zA-Z_$][0-9a-zA-Z_$]*/y,"identifier"),n=e(/(['"])(?:(?=(\\?))\2.)*?\1/y,"string"),i=e(/[+-]?(?:0[xX][0-9a-fA-F]+|0[oO][0-7]+|0[bB][01]+|\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)/y,"number"),f=e(/instanceof\b|in\b|[!=]==|\|\|=?|>>=?|<<=?|&&=?|[+\-*\/%&|^!=<>]=|[+\-*\/%&|^=<>]/y,"bin-op"),u=e(/[\s\S]*?(\${|`)/y,"`string`"),l=e(/\+\+|--|!|~|\+|-|typeof\b|delete\b|await\b/y,"unary-op"),s=e(/\/(\\.|[^\/])+\/[gimsuyd]*/y,"regexp"),a=/[\s\S]/y,o=/\S/g,c=/^[a-zA-Z0-9]+$/;export function typestripped(e,{debug:g,recover:b,transformImport:w}={}){let d=0;let y=1;let k=1;let m="";let $=0;let x=0;let A=0;let v=new Set;let E=true;let S=0;O();return m;function O(){pe(t);while(le(Z)){}if(d<e.length)ue(false)}function Z(){S=m.length;if(P()||j()||G()||z()||C()||ne()||_()||B()||F()||J()||N()||X()||q()||D()||T()||I()||pe(";"))return true;return false}function I(){if(!R())return false;oe();return true}function z(){if(!pe("export"))return false;if(pe("default")){ue(U()||ne())}else{ue(P()||j()||ne()||U()||Y())}oe();return true}function P(){if(!pe("let")&&!pe("const")&&!pe("var"))return false;if(he("enum")){console.info("Const enums are not supported");return C()}while(true){ue(pe(r));if(ce(":")){ue(ce(re))}if(pe("="))ue(U);if(!pe(","))break}oe();return true}function j(){if(!ce("type"))return false;ae();ue(ce(r));ce(H);if(ce("="))ue(ce(re));oe();return true}function C(){let e=m.length;if(!pe("enum"))return false;let t=ue(pe(r));ue(pe("{"));fe(e,`var ${t} = (function (${t}) {`);let n=0,f=true;while(f){e=m.length;let u=pe(r);if(!u)break;if(pe("=")){n=parseInt(ue(pe(i)))}if(!pe(","))f=false;fe(e,`${t}[(${t}["${u}"] = ${n++})] = "${u}";`)}e=m.length;ue(pe("}"));fe(e,`return ${t};})(${t} || {});`);return true}function _(){if(!pe("return")&&!pe("yield"))return false;U();oe();return true}function B(){const e=pe("if")||pe("while");if(!e)return false;ue(pe("("));ue(U);ue(pe(")"));ue(Z);if(e==="if"&&pe("else"))ue(Z);return true}function F(){if(!pe("throw"))return false;ue(U);oe();return true}function J(){if(!pe("do"))return false;ue(Z);ue(pe("while"));ue(pe("("));ue(U);ue(pe(")"));oe();return true}function N(){if(!pe("for"))return false;ue(pe("("));if(pe("let")||pe("const")||pe("var")){ue(pe(r));if(ce(":"))ue(ce(re));if(pe("="))ue(U)}else{R()}if(pe("of")||pe("in")){ue(R())}else{ue(pe(";"));R();ue(pe(";"));R()}ue(pe(")"));ue(Z);return true}function T(){if(!pe("switch"))return false;ue(pe("("));ue(U);ue(pe(")"));ue(pe("{"));let e=false;while(!pe("}")){if(pe("case")&&ue(U)||pe("default")){ue(pe(":"));e=true}else{ue(e&&le(Z))}}}function X(){if(!pe("import"))return false;if(pe("*")){ue(pe("as"));ue(pe(r))}else{ue(pe("{"));while(true){if(!pe(r))break;if(pe("as"))ue(pe(r));if(!pe(","))break}ue(pe("}"))}ue(pe("from"));let e=m.length;ue(pe(n));if(w){let t=m.substring(e+1,m.length-1);t=w(t);fe(e,'"'+t+'"')}oe();return true}function q(){if(!pe("try"))return;ue(G);if(pe("catch")){if(pe("(")){ue(pe(r));if(ce(":"))ue(ce(re));ue(pe(")"))}ue(G)}if(pe("finally"))ue(G);return true}function D(){if(!ce("declare"))return false;ce("enum");ue(ce(r));ue(ce(G));return true}function G(){if(!pe("{"))return false;while(le(Z)){}ue(pe("}"));return true}function H(){if(ce("<")){while(true){ue(ce(r));if(ce("extends"))ue(ce(re));if(!ce(","))break}ue(ce(">"));return true}return false}function K(e=false){let t="";if(!pe("("))return false;while(true){if(pe("..."))ue(pe(r));else if(e&&(ce("public")||ce("private")||ce("protected"))){const e=ue(pe(r));t+=`this.${e}=${e};`}else if(!pe(r))break;ce("?");if(ce(":"))ue(ce(re));if(pe("="))ue(U);if(!pe(","))break}ue(pe(")"));return e&&t?t:true}function L(){if(!pe("async","function")&&!pe("function"))return false;pe(r);H();ue(K);if(ce(":"))ue(ce(re));if(G())return true;oe();ae();return true}function M(){if(!se((()=>{pe("async");H();if(!K()&&!pe(r))return false;if(ce(":"))ue(ce(re));if(!pe("=>"))return false;return true})))return false;ue(G()||U());return true}function Q(){if(!pe("("))return false;ue(R);ue(pe(")"));return true}function R(){if(!U())return false;while(pe(","))ue(U);return true}function U(e=false){let t=false;while(pe(l))t=true;if(pe("new")){e=true;t=true}if(pe(n)||V()||pe(i)||ne()||L()||M()||Q()||pe(r)||W()||Y()||pe(s)){}else{if(t)ue(false);return false}if(e&&ce("<")){ue(ce(re));while(ce(","))ue(ce(re));ue(ce(">"))}while(true){if(he("("))ee();else if(he("["))te();else if(pe("++")||pe("--")){}else if(ce("as"))ue(ce(re));else if(pe("?."))ue(pe(r)||te());else if(pe("."))ue(pe(r));else if(pe(f)){ue(U);return true}else if(ce("!")){}else break}if(pe("?")){ue(U);ue(pe(":"));ue(U)}return true}function V(){if(!pe("`"))return false;while(true){let e=ue(pe(u));if(e.slice(-1)==="`")break;ue(U);ue(pe("}"))}return true}function W(){if(!pe("["))return false;while(true){if(pe("..."))ue(U);else U();if(!pe(","))break}ue(pe("]"));return true}function Y(){if(!pe("{"))return false;while(true){if(pe("..."))ue(U);else{pe("*");if(pe("[")){ue(U);ue(pe("]"))}else{if(!pe(r)&&!pe(i)&&!pe(n)&&!V)break}if(H()&&ue(K())||K()){if(ce(":")){ce(re)}ue(G())}else{if(pe(":"))ue(U)}if(!pe(","))break}}ue(pe("}"));return true}function ee(){if(!pe("("))return false;while(true){if(pe("..."))ue(U);else if(!U())break;if(!pe(","))break}ue(pe(")"));return true}function te(){if(!pe("["))return false;ue(R);ue(pe("]"));return true}function re(e=true){let t=false;if(pe("typeof"))return ue(U);if(pe("keyof"))t=true;if(pe(r)){if(pe("<")){ue(re);while(pe(",")){ue(re)}ue(pe(">"))}}else if(pe("{")){while(true){if(pe("[")){ue(pe(r));ue(pe(":"));ue(re);ue(pe("]"))}else if(!pe(r)&&!pe(i)&&!pe(n))break;ue(pe(":"));ue(re);if(!pe(","))break}ue(pe("}"))}else if(pe("[")){while(true){if(!re())break;if(!pe(","))break}ue(pe("]"))}else if(e&&se(K)){ue(pe("=>"));ue(re);return true}else if(pe("(")){ue(re);ue(pe(")"))}else if(!pe(i)&&!pe(n)){if(t)ue(false);return false}while(pe("[")){re();ue(pe("]"))}while(true){if(pe("|")||pe("&")){ue(re(false))}else{break}}if(pe("extends")){ue(re);ue(pe("?"));ue(re);ue(pe(":"));ue(re)}return true}function ne(){let e=false;if(ce("abstract")){ue(pe("class"))}else{if(ce("interface")){e=true;ae();$++}else if(!pe("class")){return false}}pe(r);H();if(pe("extends")){ue(U(true))}while(ce("implements"))ue(ce(re));ue(pe("{"));while(!pe("}")){ue(pe(";")||le((()=>ie(e))))}if(e)$--;return true}function ie(e=false){S=m.length;e||(e=!!ce("abstract"));ce("public")||ce("private")||ce("protected");e||(e=!!ce("abstract"));he("get",r)&&pe("get")||he("set",r)&&pe("set");if(pe("static")){if(G())return true}pe("async");pe("*");const t=pe(r);if(!t){if(pe("[")){ue(U);ue(pe("]"))}else{if(m.length!==S){ue(false)}return false}}if(!he("<")&&!he("(")){if(ce(":"))ue(ce(re));if(pe("="))ue(U);oe();return true}ce(H);let n=ue(K(t==="constructor"));if(ce(":"))ue(ce(re));if(e||!pe("{")){oe();ae();return true}if(typeof n!=="string"){while(!pe("}"))ue(le(Z));return true}if(se((()=>{fe(m.length,n);while(!pe("}")){if(he("super","("))return false;ue(le(Z))}return true})))return true;while(!pe("}")){let e=he("super","(");ue(le(Z));if(e)fe(m.length,n)}return true}function fe(e,t){let r=m.substring(e);let n=r.split("\n");let i=n.length-1;let f=t.split("\n").length-1;if(f>i)throw new Error("Invalid replaceOutput");m=m.substring(0,e)+t;m+="\n".repeat(i-f);let u=n[n.length-1];if(u.trim()==="")m+=u;if(g)ge("replace output",h(r),"by",h(m.substr(e)))}function ue(t){if(typeof t==="function")t=t();if(t)return t;let r=(new Error).stack||"";let n=/\bat parse([A-Z][a-zA-Z]*)/.exec(r)||["","top-level"];let i=[];let f=[];for(let e of v){if(e instanceof ParseError)f.push(e.message);else if(e instanceof Array)i.push(p(e," + "));else i.push(e)}let u=new ParseError(`Could not parse ${n[1]} at ${y}:${k}, got ${h(e.substr(d,8))}[..], expected one of:   ${p(i,"   ")}`);if(f.length)u.attempts=f;throw u}function le(i){if(A||!b)return i();let f=d;try{return i()}catch(i){if(!(i instanceof ParseError))throw i;console.error(i);console.info("Trying to recover...");while(d<e.length&&!pe(";")&&!pe("}")){ue(pe(t)||pe(r)||pe(n)||pe(a));if(E)break}return d>f}}function se(e){let t={pos:d,line:y,col:k,out:m,matchOptions:v};v=new Set;A++;try{let r=e();if(r)return r;if(d===t.pos&&m===t.out)return false;ue(false)}catch(e){if(!(e instanceof ParseError))throw e;t.matchOptions.add(e)}finally{A--}d=t.pos;y=t.line;k=t.col;m=t.out;if(g)ge("reverted attempt");v=t.matchOptions;return false}function ae(){const e=m.substr(S);const t=e.replace(o," ");if(e!==t){if(g)ge("wipe output",h(e));m=m.substr(0,S)+t}}function oe(){if(d>=e.length)return true;if(pe(";"))return true;if(E)return true;if(he("}"))return true;ue(false);return false}function ce(...e){$++;const t=e.length===1&&typeof e[0]==="function"?e[0]():pe(...e);$--;return t}function he(...e){x++;const t=pe(...e);x--;return t}function pe(...r){let n=d;let i;let f=false;for(let u of r){i=undefined;if(typeof u==="string"){if(e.substr(d,u.length)===u&&(!u.slice(-1).match(c)||!e.substr(d+u.length,1).match(c)))i=u}else{u.lastIndex=d;const t=u.exec(e);if(t)i=t[0]}if(i===undefined){d=n;v.add(r.length==1?r[0]:r);return}d+=i.length;t.lastIndex=d;let l=(t.exec(e)||[""])[0];d+=l.length;f=l.indexOf("\n")>=0}if(x){d=n;return i}const u=e.substring(n,d);v.clear();E=f;if(g)ge($?"skip":"eat",h(u),"as",p(r," + "));const l=u.lastIndexOf("\n");if(l>=0){y+=u.split("\n").length-1;k=u.length-l}else{k+=u.length}if($)m+=u.replace(o," ");else m+=u;return i}function ge(...e){let t=Array(...((new Error).stack||"").matchAll(/\bat parse([A-Z][a-zA-Z]+).*?(:\d+)/g)||[]).map((e=>e[1]+e[2]));(typeof g==="function"?g:console.debug)(y+":"+k,...e,"parsing",t.join(" <- "))}}function h(e){return JSON.stringify(e)}function p(e,t){return e.map((e=>typeof e==="string"?h(e):e.toString())).toSorted().join(t)}